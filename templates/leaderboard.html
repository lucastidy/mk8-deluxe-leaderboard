{% extends "base.html" %}
{% block content %}
  <h2 class="map_title">{{ map_name }}</h2>

  <div class="board-wrapper">
    <table class="board">
      <thead>
        <tr><th>#</th><th>Player</th><th>Time</th></tr>
      </thead>
      <tbody>
        {% for entry in times %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ entry.user.username }}</td>
            <td>{{ "%02d:%02d:%03d"|format(entry.time_mins, entry.time_s, entry.time_ms) }}</td>
          </tr>
        {% else %}
          <tr><td colspan="3" class="empty">No times yet — be the first!</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

<div>
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flashes">
      {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
  {% endwith %}
</div>

  <h3>Submit a Time:</h3>
  {% if current_user.is_authenticated %}
    <form method="POST" 
          action="{{ url_for('submit') }}" 
          enctype="multipart/form-data"
          class="submit-form">
      <input type="hidden" name="map_name" value="{{ map_name }}">
      <div class="input-wrapper">
        <input type="number" name="time_mins" step="0.01" min="0" placeholder="m" required>
      </div>
      <div class="input-wrapper">
        <input type="number" name="time_s" step="0.01" min="0" placeholder="s" required>
      </div>
      <div class="input-wrapper">
        <input type="number" name="time_ms" step="0.01" min="0" placeholder="ms" required>
      </div>
      <label>Time verification: <input type="file" name="screenshot" accept="image/*" required></label>
      <button type="submit" class="submit-button">Submit!</button>
    </form>
  {% else %}
      <div>
        <p>You must be logged in to submit a time:</p>
      </div>
      <div class="not-signed-up">
        <a href="{{ url_for('login') }}">Login</a>
      </div>
  {% endif %}

  <p class="back-link"><a href="{{ url_for('index') }}">← Back to tracks</a></p>
  
{% endblock %}
